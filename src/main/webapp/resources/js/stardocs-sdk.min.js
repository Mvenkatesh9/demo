/* 
 * Gnostice StarDocs
 * Copyright Â© Gnostice Information Technologies Private Limited, Bangalore, India
 * http://www.gnostice.com
 * 
*/
"use strict"
!function(){setTimeout(function(e){if("test"!==e){var t=window.setTimeout
window.setTimeout=function(e,r){var s=Array.prototype.slice.call(arguments,2)
return t(e instanceof Function?function(){e.apply(null,s)}:e,r)}}},0,"test")
var e=setInterval(function(t){if(clearInterval(e),"test"!==t){var r=window.setInterval
window.setInterval=function(e,t){var s=Array.prototype.slice.call(arguments,2)
return r(e instanceof Function?function(){e.apply(null,s)}:e,t)}}},0,"test")}()
var Gnostice=Gnostice||{}
Gnostice.ConnectionInfo=function(e,t,r,s,o){this.apiServerVersion="2.0.0",this.apiServerUrl=e||"",this.apiKey=t,this.apiSecret=r,this.serverTimeout=s||-1,this.docOperationTimeout=o||-1},Gnostice.ConnectionInfo.prototype.constructor=Gnostice.ConnectionInfo,Gnostice.DocPasswordSettings=function(e){this.forceFullPermission=e},Gnostice.DocPasswordSettings.prototype=Gnostice.DocPasswordSettings,Gnostice.Preferences=function(e){this.docPasswordSettings=e||new Gnostice.DocPasswordSettings(!1)},Gnostice.Preferences.prototype.constructor=Gnostice.Preferences,Gnostice.StarDocs=function(e,t){this.connectionInfo=e||new Gnostice.ConnectionInfo,this.preferences=t||new Gnostice.Preferences,this.urlSegAuthToken="/auth/token",this.urlSegDocs="/docs",this.urlSegDocsOps="/docs/ops",this.urlSegOps="/ops",this.urlSegInfo="/info",this.urlSegSearchText="/search-text",this.urlSegRedactText="/redact-text",this.urlSegMetaTags="/meta/tags",this.urlSegMetaOwner="/meta/owner",this.urlSegMetaFilename="/meta/filename",this.urlSegUsers="/users",this.urlSegViewSessions="/viewsessions",this.urlSegMiscTags="/misc/tags",this.urlSegMiscGroups="/misc/groups",this.urlMiscPhysicalStores="/misc/physicalstores",this.urlMiscDocumenTreeViews="/misc/documenttreeviews",this.pollInterval=1e3,this.pollRetryMaxCount=600,this.documentPassword=null,this.setDocumentPassword=function(e){this.documentPassword=e},this.viewSessionId=null,this.setViewSessionId=function(e){this.viewSessionId=e}
var r=function(e){this.starDocs=e,this.accessToken=null,this.loggedInUserName=null,this.grantType=null}
r.prototype.constructor=r,r.prototype.loginUser=function(e,t){this.loggedInUserName=null,this.grantType=null
var r=this.starDocs.connectionInfo.apiServerUrl+this.starDocs.urlSegAuthToken
console.log("In Auth.login: "+e)
var s,o=this
return s=window.btoa?"Basic "+btoa(o.starDocs.connectionInfo.apiKey+":"+o.starDocs.connectionInfo.apiSecret):"Basic "+jQuery.base64.encode(o.starDocs.connectionInfo.apiKey+":"+o.starDocs.connectionInfo.apiSecret),$.ajax({url:r,type:"POST",dataType:"json",beforeSend:function(e){e.setRequestHeader("Authorization",s)},headers:{"content-type":"application/x-www-form-urlencoded"},data:{grant_type:"password",username:e,password:t}}).then(function(e,t,r){if("success"==t)return o.setAccessToken(e.access_token,"password"),$.Deferred().resolve(e).promise()},function(e,t,r){return o.setAccessToken(null,null),$.Deferred().reject(e.status,r,e.responseJSON).promise()})},r.prototype.loginApp=function(e){this.loggedInUserName=null,this.grantType=null
var t=this.starDocs.connectionInfo.apiServerUrl+this.starDocs.urlSegAuthToken
null!=e&&(t+="?entity_id="+e),console.log("In loginApp")
var r,s=this
return r=window.btoa?"Basic "+btoa(s.starDocs.connectionInfo.apiKey+":"+s.starDocs.connectionInfo.apiSecret):"Basic "+jQuery.base64.encode(s.starDocs.connectionInfo.apiKey+":"+s.starDocs.connectionInfo.apiSecret),$.ajax({url:t,type:"POST",dataType:"json",beforeSend:function(e){e.setRequestHeader("Authorization",r)},headers:{"content-type":"application/x-www-form-urlencoded"},data:{grant_type:"client_credentials"}}).then(function(e,t,r){if("success"==t)return s.setAccessToken(e.access_token,"client_credentials"),$.Deferred().resolve(e).promise()},function(e,t,r){return s.setAccessToken(null,null),$.Deferred().reject(e.status,r,e.responseJSON).promise()})},r.prototype.setAccessToken=function(e,t){this.accessToken=e,null!==t&&(this.grantType=t)}
var s=function(e){this.starDocs=e}
s.prototype.constructor=s,s.prototype.upload=function(e,t,r){console.log("Uploading "+e)
var s=new FormData
s.append("fileUpload",e),null!=t&&s.append("password",t),s.append("forceFullPermission",this.starDocs.preferences.docPasswordSettings.forceFullPermission),r&&null!=this.starDocs.viewSessionId&&s.append("viewSessionId",this.starDocs.preferences.docPasswordSettings.forceFullPermission)
var o=this.starDocs.connectionInfo.apiServerUrl+this.starDocs.urlSegDocs
return this.starDocs.doAjaxWithBody("POST",o,s).then(function(e,t,r){return $.Deferred().resolve(e).promise()},function(e,t,r){return $.Deferred().reject(e.status,r,e.responseJSON).promise()})},s.prototype.uploadFromURL=function(e,t,r){console.log("Uploading "+e)
var s=new FormData
s.append("fileURL",e),null!=t&&s.append("password",t),s.append("forceFullPermission",this.starDocs.preferences.docPasswordSettings.forceFullPermission),r&&null!=this.starDocs.viewSessionId&&s.append("viewSessionId",this.starDocs.preferences.docPasswordSettings.forceFullPermission)
var o=this.starDocs.connectionInfo.apiServerUrl+this.starDocs.urlSegDocs
return this.starDocs.doAjaxWithBody("POST",o,s).then(function(e,t,r){return $.Deferred().resolve(e).promise()},function(e,t,r){return $.Deferred().reject(e.status,r,e.responseJSON).promise()})},s.prototype.copyFrom=function(e,t){return this.uploadFromURL(e,t)},s.prototype.uploadFromBuffer=function(e,t,r,s){console.log("Uploading from buffer")
for(var o="",n=e.byteLength,i=0;i<n;i++)o+=String.fromCharCode(e[i])
var a=new FormData,c=jQuery.base64.encode(o)
a.append("fileBuffer",c),null!=t&&a.append("fileName",t),null!=r&&a.append("password",r),a.append("forceFullPermission",this.starDocs.preferences.docPasswordSettings.forceFullPermission),s&&null!=this.starDocs.viewSessionId&&a.append("viewSessionId",this.starDocs.preferences.docPasswordSettings.forceFullPermission)
var u=this.starDocs.connectionInfo.apiServerUrl+this.starDocs.urlSegDocs
return this.starDocs.doAjaxWithBody("POST",u,a).then(function(e,t,r){return $.Deferred().resolve(e).promise()},function(e,t,r){return $.Deferred().reject(e.status,r,e.responseJSON).promise()})},s.prototype.listFiles=function(e,t,r){var s=[]
e="all",e=e.toLowerCase(),s.push("sub_set="+e),$.isArray(r)?Array.prototype.push.apply(s,r):null!=r&&s.push(r)
var o=""
o=$.isArray(t)?t.join():t||"",s.push("include_details="+o)
for(var n=this.starDocs.connectionInfo.apiServerUrl+this.starDocs.urlSegDocs,i=0;i<s.length;++i)0===i&&(n+="?"),n+=s[i],i<s.length&&(n+="&")
return this.starDocs.doAjax("GET",n).then(function(e,t,r){return $.Deferred().resolve(e).promise()},function(e,t,r){return $.Deferred().reject(e.status,r,e.responseJSON).promise()})},s.prototype.download=function(e,t){if(console.log("Downloading "+e),"boolean"!=typeof t&&(t=!0),t){var r=e
return null!==this.starDocs.auth.accessToken&&(r+="?bearer_token="+this.starDocs.auth.accessToken),console.log("url: "+r),$.Deferred().resolve(window.open(r,"_blank")).promise()}return this.starDocs.doAjax("GET",e,"text").then(function(e,t,r){return $.Deferred().resolve(r.responseText).promise()},function(e,t,r){return $.Deferred().reject(e.status,r,e.responseJSON).promise()})},s.prototype.getDownloadUrl=function(e){var t=new URI(e)
return null===this.starDocs.auth.accessToken?$.Deferred().reject(401,"You need to authenticate before calling this method.").promise():(t=t.setQuery("bearer_token",this.starDocs.auth.accessToken),$.Deferred().resolve(t).promise())},s.prototype.delete=function(e){return console.log("Deleting "+e),this.starDocs.doAjax("DELETE",e).then(function(e,t,r){return $.Deferred().resolve().promise()},function(e,t,r){return $.Deferred().reject(e.status,r,e.responseJSON).promise()})},s.prototype.setTags=function(e,t){console.log("Setting tags on  "+e)
var r=e+this.starDocs.urlSegMetaTags,s=JSON.stringify({tags:t})
return this.starDocs.doAjaxWithBody("POST",r,s,"application/json; charset=utf-8").then(function(e,t,r){return $.Deferred().resolve().promise()},function(e,t,r){return $.Deferred().reject(e.status,r,e.responseJSON).promise()})},s.prototype.updateOwner=function(e,t,r,s){console.log("Updating owner for "+e)
var o=e+this.starDocs.urlSegMetaOwner,n={user:{userNameEmail:t}}
null!==r&&(n.resetSharing=r),null!==s&&(n.retainRights=s)
var i=JSON.stringify(n)
return this.starDocs.doAjaxWithBody("PUT",o,i,"application/json; charset=utf-8").then(function(e,t,r){return $.Deferred().resolve().promise()},function(e,t,r){return $.Deferred().reject(e.status,r,e.responseJSON).promise()})},s.prototype.rename=function(e,t){console.log("Updating filename for "+e)
var r=e+this.starDocs.urlSegMetaFilename,s={fileName:t},o=JSON.stringify(s)
return this.starDocs.doAjaxWithBody("PUT",r,o,"application/json; charset=utf-8").then(function(e,t,r){if("success"==t)return $.Deferred().resolve().promise()},function(e,t,r){return $.Deferred().reject(e.status,r,e.responseJSON).promise()})}
var o=function(e){this.starDocs=e}
o.prototype.constructor=o,o.prototype.merge=function(e,t,r){for(var s=this.starDocs.connectionInfo.apiServerUrl+this.starDocs.urlSegDocsOps+"/merge",o={forceFullPermission:this.starDocs.preferences.docPasswordSettings.forceFullPermission,documents:[]},n=0;n<e.length;++n){var i={url:e[n]}
null!=t&&(i.password=t[n]),null!=r&&(i.pageRange=r[n]),o.documents.push(i)}var a=JSON.stringify(o)
return this.starDocs.doAjaxWithBodyAndPoll("POST",s,a,"application/json; charset=utf-8")},o.prototype.splitRange=function(e,t,r){var s=this.starDocs.connectionInfo.apiServerUrl+this.starDocs.urlSegDocsOps+"/split-range",o={forceFullPermission:this.starDocs.preferences.docPasswordSettings.forceFullPermission,documents:[{url:e,pageRanges:[]}]}
null!=t&&(o.documents[0].password=passwords),null!=r&&(o.documents[0].pageRanges=r)
var n=JSON.stringify(o)
return this.starDocs.doAjaxWithBodyAndPoll("POST",s,n,"application/json; charset=utf-8")},o.prototype.splitSeparatorPage=function(e,t){var r=this.starDocs.connectionInfo.apiServerUrl+this.starDocs.urlSegDocsOps+"/split-separator",s={forceFullPermission:this.starDocs.preferences.docPasswordSettings.forceFullPermission,documents:[{url:e,separatorType:"emptyPage"}]}
null!=t&&(s.documents[0].password=passwords)
var o=JSON.stringify(s)
return this.starDocs.doAjaxWithBodyAndPoll("POST",r,o,"application/json; charset=utf-8")},o.prototype.convertToBMP=function(e,t,r,s){return this.convertToImage("convert-bmp",e,t,r,s)},o.prototype.convertToGIF=function(e,t,r,s){return this.convertToImage("convert-gif",e,t,r,s)},o.prototype.convertToJPEG=function(e,t,r,s){return this.convertToImage("convert-jpeg",e,t,r,s)},o.prototype.convertToPNG=function(e,t,r,s){return this.convertToImage("convert-png",e,t,r,s)},o.prototype.convertToTIFF=function(e,t,r,s,o){return this.convertToImage("convert-tiff",e,t,r,s,o)},o.prototype.convertToMTIFF=function(e,t,r,s,o,n){return this.convertToImage("convert-mtiff",t,r,s,o,n,e)},o.prototype.convertToPDF=function(e,t,r,s,o,n){return this.convertToImage("convert-pdf",t,r,s,null,null,e,o,n)},o.prototype.encrypt=function(e,t,r,s,o,n){var i=e+this.starDocs.urlSegOps+"/encrypt",a={forceFullPermission:this.starDocs.preferences.docPasswordSettings.forceFullPermission}
null!=t&&(a.password=passwords),null!=r&&(a.encryptionLevel=r),null!=s&&(a.newOpenPassword=s),null!=o&&(a.newPermissionsPassword=o),null!=n&&(a.newPermissions=n)
var c=JSON.stringify(a)
return this.starDocs.doAjaxWithBodyAndPoll("PUT",i,c,"application/json; charset=utf-8")},o.prototype.searchText=function(e,t,r,s,o,n){var i=new URI(e).segment(this.starDocs.urlSegOps+this.starDocs.urlSegSearchText).setQuery("force-full-permission",this.starDocs.preferences.docPasswordSettings.forceFullPermission)
if(null!=t?i=i.setQuery("password",t):null!=this.starDocs.documentPassword&&(i=i.setQuery("password",this.starDocs.documentPassword)),null!=r&&""!=r&&(i=i.setQuery("page_range",r)),null!=s&&(i=i.setQuery("mode",s)),null!=o&&o instanceof Array)for(var a=0;a<o.length;++a){var c=o[a]
if(null!=c.text&&""!=c.text){var u=!0===c.caseSensitive,l=!0===c.wholeWord,d="text"
u&&l?d="text_case_word":u&&!l?d="text_case":!u&&l&&(d="text_word"),i=i.setQuery(d,c.text)}}return null!=n&&"object"==typeof n&&(!1===n.pageText&&(i=i.setQuery("scope_page_text",!1)),!0===n.pageImages&&(i=i.setQuery("scope_page_images",!0)),!0===n.bookmarks&&(i=i.setQuery("scope_bookmarks",!0)),!0===n.bookmarkActions&&(i=i.setQuery("scope_bookmark_actions",!0)),!0===n.annotations&&(i=i.setQuery("scope_annotations",!0)),!0===n.annotationActions&&(i=i.setQuery("scope_annotation_actions",!0)),!0===n.documentProperties&&(i=i.setQuery("scope_document_properties",!0))),this.starDocs.doAjaxAndPoll("GET",i.toString())},o.prototype.redactText=function(e,t,r,s,o,n,i,a,c){var u=e+this.starDocs.urlSegOps+this.starDocs.urlSegRedactText,l={forceFullPermission:this.starDocs.preferences.docPasswordSettings.forceFullPermission}
null!=t&&(l.password=passwords),null!=r&&(l.pageRange=r),null!=s&&(l.searchMode=s),null!=o&&(l.searchText=o),null!=n&&(l.removeAssociatedAnnotations=n),null!=i&&(l.fillSettings=i),null!=a&&(l.includeAdditionalItems=a),null!=c&&(l.cleanupSettings=c)
var d=JSON.stringify(l)
return this.starDocs.doAjaxWithBodyAndPoll("PUT",u,d,"application/json; charset=utf-8")},o.prototype.fillForm=function(e,t,r,s){var o=e+this.starDocs.urlSegOps+"/fill-form",n={forceFullPermission:this.starDocs.preferences.docPasswordSettings.forceFullPermission}
null!=t&&(n.password=t),null!=r&&(n.fields=r),!0===s&&(n.flattenAllFields=s)
var i=JSON.stringify(n)
return this.starDocs.doAjaxWithBodyAndPoll("PUT",o,i,"application/json; charset=utf-8")},o.prototype.convertToImage=function(e,t,r,s,o,n,i,a,c){for(var u=this.starDocs.connectionInfo.apiServerUrl+this.starDocs.urlSegDocsOps+"/"+e,l={forceFullPermission:this.starDocs.preferences.docPasswordSettings.forceFullPermission,documents:[]},d=0;d<t.length;++d){var p={url:t[d]}
null!=r&&(p.password=r[d]),null!=s&&(p.pageRange=s[d]),l.documents.push(p)}null!=o&&(l.imageEncoderSettings=o),null!=n&&(l.tiffCompressionType=n),null!=i&&(l.conversionMode=i),null!=a&&(l.pdfEncoderSettings=a),null!=c&&(l.digitizerSettings=c)
var f=JSON.stringify(l)
return this.starDocs.doAjaxWithBodyAndPoll("POST",u,f,"application/json; charset=utf-8")},o.prototype.getDocInfo=function(e,t){var r=new URI(e).segment(this.starDocs.urlSegInfo).setQuery("force-full-permission",this.starDocs.preferences.docPasswordSettings.forceFullPermission)
return null!=t?r=r.setQuery("password",t):null!=this.starDocs.documentPassword&&(r=r.setQuery("password",this.starDocs.documentPassword)),this.starDocs.doAjaxAndPoll("GET",r.toString())},o.prototype.getDocBookmarks=function(e,t){var r=new URI(e).segment("bookmarks").setQuery("force-full-permission",this.starDocs.preferences.docPasswordSettings.forceFullPermission)
return null!=t?r=r.setQuery("password",t):null!=this.starDocs.documentPassword&&(r=r.setQuery("password",this.starDocs.documentPassword)),this.starDocs.doAjaxAndPoll("GET",r.toString())},o.prototype.getPageImage=function(e,t,r){t=t||{}
var s=new URI(e).setQuery("force-full-permission",this.starDocs.preferences.docPasswordSettings.forceFullPermission)
return null!=t.dpi&&(s=s.setQuery("dpi",t.dpi)),null!=t.renderFormFields&&(s=s.setQuery("render-form-fields",t.renderFormFields)),null!=r?s=s.setQuery("password",r):null!=this.starDocs.documentPassword&&(s=s.setQuery("password",this.starDocs.documentPassword)),this.starDocs.doAjaxAndPoll("GET",s.toString())},o.prototype.getPageThumbnail=function(e,t,r){t=t||{}
var s=new URI(e).segment("thumbnail").setQuery("force-full-permission",this.starDocs.preferences.docPasswordSettings.forceFullPermission)
return null!=t.dpi&&(s=s.setQuery("dpi",t.dpi)),null!=t.renderFormFields&&(s=s.setQuery("render-form-fields",t.renderFormFields)),null!=r?s=s.setQuery("password",r):null!=this.starDocs.documentPassword&&(s=s.setQuery("password",this.starDocs.documentPassword)),this.starDocs.doAjaxAndPoll("GET",s.toString())},o.prototype.getDocumentPrintImageURLs=function(e,t){var r=new URI(e).segment(this.starDocs.urlSegOps).segment("prepare-print-images"),s={forceFullPermission:this.starDocs.preferences.docPasswordSettings.forceFullPermission}
null!=t?s.password=passwords:null!=this.starDocs.documentPassword&&(s.password=this.starDocs.documentPassword)
var o=JSON.stringify(s),n=$.Deferred(),i=this
return this.starDocs.doAjaxWithBodyAndPoll("POST",r.toString(),o,"application/json; charset=utf-8").done(function(t){console.log("In getDocumentPrintImageURLs: Pages ready "+t)
for(var r=[],s=t.largestRenderedPageCount,o=new URI(e).segment("pages"),a=1;a<=s;++a){var c=o.toString()+"/"+a+"/image",u=new URI(c).setQuery("bearer_token",i.starDocs.auth.accessToken).toString()
r.push(u)}n.resolve(r)}).fail(function(e,t,r){console.log("In getDocumentPrintImageURLs: fail event called"),n.reject(e,t,r)}),n.promise()},o.prototype.getPageFormFields=function(e,t){var r=new URI(e).segment("formfields").setQuery("force-full-permission",this.starDocs.preferences.docPasswordSettings.forceFullPermission)
return null!=t?r=r.setQuery("password",t):null!=this.starDocs.documentPassword&&(r=r.setQuery("password",this.starDocs.documentPassword)),this.starDocs.doAjaxAndPoll("GET",r.toString())},o.prototype.getPageText=function(e,t){var r=new URI(e).segment("text").setQuery("force-full-permission",this.starDocs.preferences.docPasswordSettings.forceFullPermission)
return null!=t?r=r.setQuery("password",t):null!=this.starDocs.documentPassword&&(r=r.setQuery("password",this.starDocs.documentPassword)),this.starDocs.doAjaxAndPoll("GET",r.toString())}
var n=function(e){this.starDocs=e}
n.prototype.constructor=n,n.prototype.listUsers=function(){var e=this.starDocs.connectionInfo.apiServerUrl+this.starDocs.urlSegUsers
return this.starDocs.doAjax("GET",e).then(function(e,t,r){return $.Deferred().resolve(e).promise()},function(e,t,r){return $.Deferred().reject(e.status,r,e.responseJSON).promise()})},n.prototype.getUserDetails=function(e){return e=e||this.starDocs.connectionInfo.apiServerUrl+this.starDocs.urlSegUsers+"/me",this.starDocs.doAjax("GET",e).then(function(e,t,r){return $.Deferred().resolve(e).promise()},function(e,t,r){return $.Deferred().reject(e.status,r,e.responseJSON).promise()})}
var i=function(e){this.starDocs=e}
i.prototype.constructor=i,i.prototype.createView=function(e,t,r){console.log("Creating viewer for doc "+e)
var s=this.starDocs.connectionInfo.apiServerUrl+this.starDocs.urlSegViewSessions
r=r||{},t=t||""
var o=JSON.stringify({forceFullPermission:this.starDocs.preferences.docPasswordSettings.forceFullPermission,documents:[{url:e,password:t}],viewerSettings:r})
return this.starDocs.doAjaxWithBody("POST",s,o,"application/json; charset=utf-8").then(function(e,t,r){return $.Deferred().resolve(e).promise()},function(e,t,r){return $.Deferred().reject(e.status,r,e.responseJSON).promise()})}
var a=function(e){this.starDocs=e}
a.prototype.constructor=a,a.prototype.getLookupTags=function(){var e=this.starDocs.connectionInfo.apiServerUrl+this.starDocs.urlSegMiscTags
return this.starDocs.doAjax("GET",e).then(function(e,t,r){return $.Deferred().resolve(e).promise()},function(e,t,r){return $.Deferred().reject(e.status,r,e.responseJSON).promise()})},a.prototype.listGroups=function(){var e=this.starDocs.connectionInfo.apiServerUrl+this.starDocs.urlSegMiscGroups
return this.starDocs.doAjax("GET",e).then(function(e,t,r){return $.Deferred().resolve(e).promise()},function(e,t,r){return $.Deferred().reject(e.status,r,e.responseJSON).promise()})},a.prototype.listPhysicalStores=function(){var e=this.starDocs.connectionInfo.apiServerUrl+this.starDocs.urlMiscPhysicalStores
return this.starDocs.doAjax("GET",e).then(function(e,t,r){return $.Deferred().resolve(e).promise()},function(e,t,r){return $.Deferred().reject(e.status,r,e.responseJSON).promise()})},a.prototype.listDocumentTreeViews=function(){var e=this.starDocs.connectionInfo.apiServerUrl+this.starDocs.urlMiscDocumenTreeViews
return this.starDocs.doAjax("GET",e).then(function(e,t,r){return $.Deferred().resolve(e).promise()},function(e,t,r){return $.Deferred().reject(e.status,r,e.responseJSON).promise()})},a.prototype.createDocumentTreeView=function(e,t){var r=this.starDocs.connectionInfo.apiServerUrl+this.starDocs.urlMiscDocumenTreeViews,s=JSON.stringify({documentTreeView:{name:e,tagKeys:t}})
return this.starDocs.doAjaxWithBody("POST",r,s,"application/json; charset=utf-8").then(function(e,t,r){return $.Deferred().resolve(e).promise()},function(e,t,r){return $.Deferred().reject(e.status,r,e.responseJSON).promise()})},a.prototype.editDocumentTreeView=function(e,t,r){var s=JSON.stringify({documentTreeView:{name:t,tagKeys:r}})
return this.starDocs.doAjaxWithBody("PUT",e,s,"application/json; charset=utf-8").then(function(e,t,r){return $.Deferred().resolve().promise()},function(e,t,r){return $.Deferred().reject(e.status,r,e.responseJSON).promise()})},a.prototype.deleteDocumentTreeView=function(e){return console.log("Deleting "+e),this.starDocs.doAjax("DELETE",e).then(function(e,t,r){return $.Deferred().resolve().promise()},function(e,t,r){return $.Deferred().reject(e.status,r,e.responseJSON).promise()})},this.auth=new r(this),this.storage=new s(this),this.docOperations=new o(this),this.userMgmt=new n(this),this.viewer=new i(this),this.misc=new a(this)},Gnostice.StarDocs.prototype.constructor=Gnostice.StarDocs,Gnostice.StarDocs.prototype.assertUserLogin=function(){if(null===this.auth.accessToken)throw new Error("Authentication required")},Gnostice.StarDocs.prototype.doAjax=function(e,t,r){var s=this
return $.ajax({url:t,type:e,dataType:r||"json",beforeSend:function(e){null!==s.auth.grantType&&null!==s.auth.accessToken&&e.setRequestHeader("Authorization","Bearer "+s.auth.accessToken)},contentType:!1,cache:!1,processData:!1})},Gnostice.StarDocs.prototype.doAjaxWithBody=function(e,t,r,s,o){var n=this
return $.ajax({url:t,type:e,dataType:o||"json",beforeSend:function(e){null!==n.auth.grantType&&null!==n.auth.accessToken&&e.setRequestHeader("Authorization","Bearer "+n.auth.accessToken)},data:r,contentType:s||!1,cache:!1,processData:!1})},Gnostice.StarDocs.prototype.doAjaxAndPoll=function(e,t,r){var s=this.doAjax(e,t,r),o=this
return s.then(function(e,t,r){if(200===r.status)return $.Deferred().resolve(e).promise()
if(202===r.status){var s=$.Deferred(),n=new URI(r.getResponseHeader("location"))
return o.preferences.docPasswordSettings.forceFullPermission&&(n=n.setQuery("force-full-permission",!0)),null!=o.documentPassword&&(n=n.setQuery("password",o.documentPassword)),setTimeout(o.doPoll,o.pollInterval,n.toString(),s,o,1),s.promise()}return $.Deferred().reject(r.status,t,r.responseJSON).promise()},function(e,t,r){return $.Deferred().reject(e.status,r,e.responseJSON).promise()})},Gnostice.StarDocs.prototype.doAjaxWithBodyAndPoll=function(e,t,r,s,o){var n=this.doAjaxWithBody(e,t,r,s,o),i=this
return n.then(function(e,t,r){if(201===r.status)return $.Deferred().resolve(e).promise()
if(202===r.status){var s=$.Deferred(),o=r.getResponseHeader("location")
return o=o+"?force-full-permission="+i.preferences.docPasswordSettings.forceFullPermission,null!=i.documentPassword&&(o=o+"&password="+encodeURIComponent(i.documentPassword)),setTimeout(i.doPoll,i.pollInterval,o,s,i,1),s.promise()}return $.Deferred().reject(r.status,t,r.responseJSON).promise()},function(e,t,r){return $.Deferred().reject(e.status,r,e.responseJSON).promise()})},Gnostice.StarDocs.prototype.doPoll=function(e,t,r,s){return console.log("In doPoll: Polling "+e),r.doAjax("GET",e).then(function(o,n,i){if(200===i.status||201===i.status)console.log("In doPoll: done "+e),t.resolve(o)
else if(202===i.status){if(console.log("In doPoll: output not yet ready "),++s>=r.pollRetryMaxCount)return console.log("In doPoll: Retry count exceeded "),void t.reject(200,"OK",0,"Exceeded poll retry count.")
setTimeout(r.doPoll,r.pollInterval,e,t,r,s)}else console.log("In doPoll: Unexpected status code "+i.status),t.reject(i.status,n,i.responseJSON)},function(e,r,s){return console.log("In doPoll: error textStatus="+r+", errorThrown="+s),t.reject(e.status,s,e.responseJSON)})},Gnostice.StarDocs.prototype.parsePageRangeSettings=function(e){var t={range:""}
if(e.length<1)return t
var r=e.indexOf("|")
if(-1==r)return t.range=e,t
t.range=e.substring(0,r)
var s=e.indexOf("|",r+1)
return-1==s?(t.subRangeMode=e.substring(r+1),t):(t.subRangeMode=e.substring(r+1,s),t.reverseOrder="true"===e.substring(s+1).toLowerCase(),t)},Gnostice.bindInterFrameFunctions=function(e,t){e.bind("submitForm",function(e,r){r=r||{},t.forms.submitForm(r.submitUrl,r.submitMethod,r.includeNoValueFields,r.submitFields,r.isIncludeList).done(function(t,r,s){e.complete(t)}).fail(function(t,r,s){e.error(r,s)}),e.delayReturn(!0)}),e.bind("resetForm",function(e,r){return r=r||{},t.forms.resetForm(r.resetFields,r.isIncludeList)})
var r=function(e){if(null==e)return null
var t={},s=["_formsModule","_widget"]
for(var o in e)if(e.hasOwnProperty(o)&&!s.includes(o))if("radioButtons"===o){t[o]=[]
for(var n=0;n<e[o].length;++n)t[o].push(r(e[o][n]))}else t[o]=e[o]
return t.value=e.getValueAsString(),t}
e.bind("invokeFn",function(e,s){s=s||{}
var o=s.fnName,n=s.params
if("Forms.getFormField"==o){var i=t.forms.getFormField(n.formFieldName)
return r(i)}if("Forms.getAllFormFields"==o){for(var a=t.forms.getAllFormFields(),c={textFormFields:[],radioGroupFormFields:[],comboBoxFormFields:[],listBoxFormFields:[],checkBoxFormFields:[],submitPushButtonFormFields:[],resetPushButtonFormFields:[],simplePushButtonFormFields:[]},u=0;u<a.length;++u){var l=r(a[u])
switch(l.type){case"text":c.textFormFields.push(l)
break
case"radioGroup":c.radioGroupFormFields.push(l)
break
case"comboBox":c.comboBoxFormFields.push(l)
break
case"listBox":c.listBoxFormFields.push(l)
break
case"checkBox":c.checkBoxFormFields.push(l)
break
case"submitPushButton":c.submitPushButtonFormFields.push(l)
break
case"resetPushButton":c.resetPushButtonFormFields.push(l)
break
case"simplePushButton":c.simplePushButtonFormFields.push(l)}}return c}if("Forms.getValueAsString"==o){var i=t.forms.getFormField(n.formFieldName)
return null!=i?i.getValueAsString():null}if("Forms.setValueAsString"==o){var i=t.forms.getFormField(n.formFieldName)
return null!=i&&(i.setValueAsString(n.value),!0)}if("Forms.getRadioButtonSelectedIndex"==o){var i=t.forms.getFormField(n.formFieldName)
return null!=i&&"radioGroup"===i.type?i.getSelectedRadioButtonIndex():null}if("Forms.setRadioButtonSelectedIndex"==o){var i=t.forms.getFormField(n.formFieldName)
return null!=i&&i instanceof gnostice.RadioGroupFormField&&(i.setSelectedRadioButtonIndex(n.selectedIndex),!0)}if("Forms.getComboListBoxSelectedItemIndices"==o){var i=t.forms.getFormField(n.formFieldName)
return null==i||"comboBox"!==i.type&&"listBox"!==i.type?null:i.getSelectedItemIndices()}if("Forms.setComboListBoxSelectedItemIndices"==o){var i=t.forms.getFormField(n.formFieldName)
return null!=i&&(i instanceof gnostice.ComboBoxFormField||i instanceof gnostice.ListBoxFormField)&&(i.setSelectedItemIndices(n.selectedIndices),!0)}if("Forms.setComboBoxValue"==o){var i=t.forms.getFormField(n.formFieldName)
return null!=i&&i instanceof gnostice.ComboBoxFormField&&(i.setValue(n.value),!0)}if("Forms.getCheckBoxChecked"==o){var i=t.forms.getFormField(n.formFieldName)
return null!=i&&"checkBox"===i.type?i.getChecked():null}if("Forms.setCheckBoxChecked"==o){var i=t.forms.getFormField(n.formFieldName)
return null!=i&&i instanceof gnostice.CheckBoxFormField&&(i.setChecked(n.checked),!0)}if("Forms.resetForm"==o)return t.forms.resetForm(n.resetFields,n.isIncludeList)
if("Forms.focusForm"==o)return t.forms.focusForm()
if("Forms.setFocus"==o){var i=t.forms.getFormField(n.formFieldName)
return null!=i&&(i.setFocus(),!0)}if("View.firstPage"==o)return t.firstPage()
if("View.lastPage"==o)return t.lastPage()
if("View.prevPage"==o)return t.prevPage()
if("View.nextPage"==o)return t.nextPage()
if("View.gotoPage"==o)return t.gotoPage(n.pageNum)
if("View.getPageCount"==o)return t.getPageCount()
if("View.zoomIn"==o)return t.zoomIn()
if("View.zoomOut"==o)return t.zoomOut()
if("View.rotateClockwise"==o)return t.rotatePagesClockwise()
if("View.rotateCounterClockwise"==o)return t.rotatePagesCounterClockwise()
if("View.invertColors"==o)return t.invertColors(n.applyInversion)
if("download"==o)return t.download()
if("downloadAs"==o)return t.downloadAs(n.extension)
if("print"==o)return t.print()
if("uploadDocumentFromUri"==o)return t.uploadDocumentFromUri(n.uri)
if("uploadDocumentFromBuffer"==o)return t.uploadDocumentFromBuffer(n.bufferBase64)
if("save"==o)return t.save()
if("Forms.submitForm"==o){var d=1
null!=n.submitMethod&&"GET"==n.submitMethod.toUpperCase()&&(d=0),t.forms.submitForm(n.submitUrl,d,n.includeNoValueFields,n.submitFields,n.isIncludeList).done(function(t,r,s){e.complete(t,r)}).fail(function(t,r,s){e.error(r,s)}),e.delayReturn(!0)}else if("Forms.addEventListener"==o){console.log("In child frame Forms.addEventListener")
var p=n.eventName,f=n.formFieldSpec,m=n.eventCb
console.log("eventName="+p+", formFieldSpec="+f),null!=p&&null!=m&&t.forms.addEventListener(p,f,function(e){e.hasOwnProperty("viewerManager")&&delete e.viewerManager,e.hasOwnProperty("formField")&&(e.formField=r(e.formField)),m(e)}),e.delayReturn(!0)}else e.error("Unknown function: "+o,"")})}
